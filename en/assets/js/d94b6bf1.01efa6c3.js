"use strict";(self.webpackChunkpersonal_site=self.webpackChunkpersonal_site||[]).push([[5575],{6696:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var t=n(4848),a=n(8453);const r={},o="Ways of connecting to the server",i={id:"SystemManager/Ways of connecting to the server",title:"Ways of connecting to the server",description:"We can use many ways to connect to the server. AWS gives us several ways, which I describe below.",source:"@site/docs/SystemManager/02-Ways of connecting to the server.md",sourceDirName:"SystemManager",slug:"/SystemManager/Ways of connecting to the server",permalink:"/en/docs/SystemManager/Ways of connecting to the server",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/SystemManager/02-Ways of connecting to the server.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Connection to a public and private instance EC2 via Session Manager",permalink:"/en/docs/SystemManager/introduction"},next:{title:"How to connect via Session Manager?",permalink:"/en/docs/SystemManager/How to connect via Session Manager"}},c={},l=[{value:"EC2 Instance Connect",id:"ec2-instance-connect",level:2},{value:"Session Manager",id:"session-manager",level:2},{value:"SSH client",id:"ssh-client",level:2},{value:"EC2 serial console",id:"ec2-serial-console",level:2},{value:"How to regain access to the server ?",id:"how-to-regain-access-to-the-server-",level:3},{value:"Set a password for the local user on EC2",id:"set-a-password-for-the-local-user-on-ec2",level:4}];function h(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"ways-of-connecting-to-the-server",children:"Ways of connecting to the server"}),"\n",(0,t.jsx)(s.p,{children:"We can use many ways to connect to the server. AWS gives us several ways, which I describe below."}),"\n",(0,t.jsx)(s.h2,{id:"ec2-instance-connect",children:"EC2 Instance Connect"}),"\n",(0,t.jsx)(s.p,{children:"Important:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"You don't need to share and manage SSH keys."}),"\n",(0,t.jsx)(s.li,{children:"The instance must have a public IPv4 address."}),"\n",(0,t.jsx)(s.li,{children:"You can connect to the instance over a private network EC2 Instance Connect CLI from other servers."}),"\n",(0,t.jsx)(s.li,{children:"As a username, you can specify any user that exists in the system and has the ability to log in."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Read more:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Connect-using-EC2-Instance-Connect.html",children:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Connect-using-EC2-Instance-Connect.html"})}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"session-manager",children:"Session Manager"}),"\n",(0,t.jsx)(s.p,{children:"Session Manager is a fully managed AWS Systems Manager capability that lets you manage your Amazon EC2 instances through an interactive one-click browser-based shell or through the AWS CLI"}),"\n",(0,t.jsx)(s.p,{children:"Important:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"SSM Agent should be installed on the instance."}),"\n",(0,t.jsx)(s.li,{children:"Create IAM Instance Profile and attach IAM role to instance."}),"\n",(0,t.jsx)(s.li,{children:"Security group added to VPC endpoint must allow inbound HTTPS (port 443) traffic from the resources in your VPC that communicate with the service."}),"\n",(0,t.jsx)(s.li,{children:"Enabling private DNS requires both enableDnsSupport and enableDnsHostnames VPC attributes set to true for VPC."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Example of a connection AWS CLI:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"aws ssm start-session --target INSTANCE_ID\n"})}),"\n",(0,t.jsx)(s.p,{children:"Read more:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["SSM Agent ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/ssm-agent.html",children:"https://docs.aws.amazon.com/systems-manager/latest/userguide/ssm-agent.html"})]}),"\n",(0,t.jsxs)(s.li,{children:["Session Manager ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/session-manager.html",children:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/session-manager.html"})]}),"\n",(0,t.jsxs)(s.li,{children:["Instance Profile ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/setup-instance-profile.html",children:"https://docs.aws.amazon.com/systems-manager/latest/userguide/setup-instance-profile.html"})]}),"\n",(0,t.jsxs)(s.li,{children:["Attach IAM role ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#attach-iam-role",children:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#attach-iam-role"})]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"ssh-client",children:"SSH client"}),"\n",(0,t.jsx)(s.p,{children:"Important:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"You need to share and manage SSH keys."}),"\n",(0,t.jsx)(s.li,{children:"The security group must allow inbound SSH (port 22)."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Example of a connection"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"ssh -i /path/key-pair-name.pem instance-user-name@instance-public-dns-name\n"})}),"\n",(0,t.jsx)(s.p,{children:"Read more:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Putty ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/putty.html",children:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/putty.html"})]}),"\n",(0,t.jsxs)(s.li,{children:["OpenSSH ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/openssh.html",children:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/openssh.html"})]}),"\n",(0,t.jsxs)(s.li,{children:["WSL ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/WSL.html",children:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/WSL.html"})]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"ec2-serial-console",children:"EC2 serial console"}),"\n",(0,t.jsx)(s.p,{children:"Important:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:'You need to Allowed "EC2 Serial Console" in "EC2 Settings".'}),"\n",(0,t.jsx)(s.li,{children:"We need to be able to log into the server from the local console. Login with a password."}),"\n",(0,t.jsx)(s.li,{children:"We must use an instance type that is built on the AWS Nitro System."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"When to use?"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"When we want to change the password"}),"\n",(0,t.jsx)(s.li,{children:"When we want to regain access to the server"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Enable EC2 Serial Console:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"aws ec2 enable-serial-console-access --region us-east-1\n"})}),"\n",(0,t.jsx)(s.p,{children:"Read more:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Configure access to the EC2 Serial Console ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configure-access-to-serial-console.html",children:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configure-access-to-serial-console.html"})]}),"\n",(0,t.jsxs)(s.li,{children:["Instances built on the Nitro System ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-types.htmlicmpid=docs_ec2_console#ec2-nitro-instances",children:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-types.htmlicmpid=docs_ec2_console#ec2-nitro-instances"})]}),"\n",(0,t.jsxs)(s.li,{children:["Default users: ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/managing-users.html",children:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/managing-users.html"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"how-to-regain-access-to-the-server-",children:"How to regain access to the server ?"}),"\n",(0,t.jsx)(s.p,{children:"Case:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"We don't have SSH keys."}),"\n",(0,t.jsx)(s.li,{children:"The SSH server is not working."}),"\n",(0,t.jsx)(s.li,{children:"We do not have a password for the user"}),"\n",(0,t.jsx)(s.li,{children:"The SSM agent has not been installed."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:'By default, no password is generated for the user "ec2-user" in the Amazon Linux 2 image. We can set this password, put the SSH public key or fix other things.'}),"\n",(0,t.jsx)(s.p,{children:"We have a few popular ways to do this:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Create an AMI from the failed server/EBS and create a new server with the AMI."}),"\n",(0,t.jsx)(s.li,{children:"Shut down the instance, disconnect the EBS and attach the EBS to a new temporary server where we can repair the services/files on that EBS."}),"\n",(0,t.jsx)(s.li,{children:"Set a password for the local user."}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"set-a-password-for-the-local-user-on-ec2",children:"Set a password for the local user on EC2"}),"\n",(0,t.jsx)(s.p,{children:'We can use "User data" for this purpose. By default, the user data works when the server is first started.'}),"\n",(0,t.jsx)(s.p,{children:"We can run the following command to set the password for user ec2-user:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:' echo "password" | passwd --stdin ec2-user\n'})}),"\n",(0,t.jsx)(s.p,{children:"Example of a script that runs once:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'#!/bin/bash\n/bin/echo "Hello World" >> /tmp/helloworld.txt\necho "password" | passwd --stdin ec2-user\n'})}),"\n",(0,t.jsx)(s.p,{children:"What we should to do?"}),"\n",(0,t.jsx)(s.p,{children:'We can add the following script to "User data", that runs every time the server starts.'}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'Content-Type: multipart/mixed; boundary="//"\nMIME-Version: 1.0\n\n--//\nContent-Type: text/cloud-config; charset="us-ascii"\nMIME-Version: 1.0\nContent-Transfer-Encoding: 7bit\nContent-Disposition: attachment; filename="cloud-config.txt"\n\n#cloud-config\ncloud_final_modules:\n- [scripts-user, always]\n\n--//\nContent-Type: text/x-shellscript; charset="us-ascii"\nMIME-Version: 1.0\nContent-Transfer-Encoding: 7bit\nContent-Disposition: attachment; filename="userdata.txt"\n\n#!/bin/bash\necho "password" | passwd --stdin ec2-user\n\n--//--\n'})}),"\n",(0,t.jsx)(s.p,{children:"This set a password (password) for the user ec2-user."}),"\n",(0,t.jsx)(s.p,{children:"Read more:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html",children:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://aws.amazon.com/premiumsupport/knowledge-center/execute-user-data-ec2/",children:"https://aws.amazon.com/premiumsupport/knowledge-center/execute-user-data-ec2/"})}),"\n"]})]})}function d(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>i});var t=n(6540);const a={},r=t.createContext(a);function o(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);