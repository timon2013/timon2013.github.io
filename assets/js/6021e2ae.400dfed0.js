"use strict";(self.webpackChunkpersonal_site=self.webpackChunkpersonal_site||[]).push([[7285],{1687:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>t});var a=s(4848),i=s(8453);const o={},l="Jak po\u0142\u0105czy\u0107 si\u0119 za pomoc\u0105 Session Manager?",r={id:"SystemManager/How to connect via Session Manager",title:"Jak po\u0142\u0105czy\u0107 si\u0119 za pomoc\u0105 Session Manager?",description:"Minimalne kroki do po\u0142\u0105czenia",source:"@site/docs/SystemManager/03-How to connect via Session Manager.md",sourceDirName:"SystemManager",slug:"/SystemManager/How to connect via Session Manager",permalink:"/docs/SystemManager/How to connect via Session Manager",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/SystemManager/03-How to connect via Session Manager.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Sposoby \u0142\u0105czenia si\u0119 z serwerem",permalink:"/docs/SystemManager/Ways of connecting to the server"},next:{title:"Serwery w sieci prywatnej bez dost\u0119pu publicznego. Czy potrzebujemy Bastion Host?",permalink:"/docs/SystemManager/Servers on a private network without public access"}},c={},t=[{value:"Minimalne kroki do po\u0142\u0105czenia",id:"minimalne-kroki-do-po\u0142\u0105czenia",level:2},{value:"Agent SSM",id:"agent-ssm",level:3},{value:"Profil instancji IAM",id:"profil-instancji-iam",level:3},{value:"Zezwolenie na ruch HTTPS w grupie zabezpiecze\u0144",id:"zezwolenie-na-ruch-https-w-grupie-zabezpiecze\u0144",level:3},{value:"\u0141\u0105czenie si\u0119 z instancj\u0105",id:"\u0142\u0105czenie-si\u0119-z-instancj\u0105",level:2},{value:"Konsola zarz\u0105dzania AWS",id:"konsola-zarz\u0105dzania-aws",level:3},{value:"Interfejs wiersza polece\u0144 AWS",id:"interfejs-wiersza-polece\u0144-aws",level:3},{value:"W\u0142\u0105czanie logowania sesji do S3 i CloudWatch z szyfrowaniem",id:"w\u0142\u0105czanie-logowania-sesji-do-s3-i-cloudwatch-z-szyfrowaniem",level:2},{value:"Co musimy zrobi\u0107?",id:"co-musimy-zrobi\u0107",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"jak-po\u0142\u0105czy\u0107-si\u0119-za-pomoc\u0105-session-manager",children:"Jak po\u0142\u0105czy\u0107 si\u0119 za pomoc\u0105 Session Manager?"}),"\n",(0,a.jsx)(n.h2,{id:"minimalne-kroki-do-po\u0142\u0105czenia",children:"Minimalne kroki do po\u0142\u0105czenia"}),"\n",(0,a.jsx)(n.h3,{id:"agent-ssm",children:"Agent SSM"}),"\n",(0,a.jsx)(n.p,{children:"Przygotuj instancj\u0119 lub AMI z zainstalowanym agentem SSM lub u\u017cyj jednej z tej listy:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/ami-preinstalled-agent.html",children:"https://docs.aws.amazon.com/systems-manager/latest/userguide/ami-preinstalled-agent.html"})}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"R\u0119czna instalacja agenta SSM na instancjach EC2 z systemem Linux"}),"\n",(0,a.jsx)(n.p,{children:"Przyk\u0142ad dla CentOS Stream:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#Zas\xf3b globalny:\nsudo dnf install -y https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/linux_amd64/amazon-ssm-agent.rpm\n\n#Region specyficzny: us-east-1\nsudo dnf install -y https://s3.us-east-1.amazonaws.com/amazon-ssm-us-east-1/latest/linux_amd64/amazon-ssm-agent.rpm\nsudo systemctl status amazon-ssm-agent\nsudo systemctl enable amazon-ssm-agent\nsudo systemctl start amazon-ssm-agent\n"})}),"\n",(0,a.jsx)(n.p,{children:"Przyk\u0142ad dla Ubuntu 20.10:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"sudo snap install amazon-ssm-agent --classic\nsudo snap list amazon-ssm-agent\nsudo snap start amazon-ssm-agent\nsudo snap services amazon-ssm-agent\n"})}),"\n",(0,a.jsx)(n.p,{children:"Wi\u0119cej informacji:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-manual-agent-install.html",children:"https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-manual-agent-install.html"})}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"profil-instancji-iam",children:"Profil instancji IAM"}),"\n",(0,a.jsxs)(n.p,{children:["Utw\xf3rz profil instancji IAM dla Systems Manager i przypisz rol\u0119 IAM do instancji (",(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/setup-instance-profile.html",children:"https://docs.aws.amazon.com/systems-manager/latest/userguide/setup-instance-profile.html"}),")"]}),"\n",(0,a.jsx)(n.p,{children:"Tworzenie profilu instancji:"}),"\n",(0,a.jsx)(n.p,{children:"Wa\u017cne:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Gdy tworzysz role dla EC2, profil instancji jest tworzony automatycznie."}),"\n",(0,a.jsx)(n.li,{children:"Je\u015bli tworzysz role za pomoc\u0105 AWS CLI, profil instancji nie jest tworzony. Musisz go utworzy\u0107 r\u0119cznie."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Jak to wygl\u0105da w AWS CLI?"}),"\n",(0,a.jsx)(n.p,{children:"Potrzebujesz polityki zaufania dla roli:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'cat <<EOT >> Role-Trust-Policy.json\n{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Principal": {\n                "Service": "ec2.amazonaws.com"\n            },\n            "Action": "sts:AssumeRole"\n        }\n    ]\n}\nEOT\n'})}),"\n",(0,a.jsx)(n.p,{children:"Nast\u0119pnie musisz utworzy\u0107 rol\u0119 z niezb\u0119dnymi politykami, profil instancji i przypisa\u0107 rol\u0119 do profilu instancji:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"aws iam create-role --role-name Role-SSM-instance --assume-role-policy-document file://Role-Trust-Policy.json\naws iam attach-role-policy --policy-arn arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore --role-name Role-SSM-instance\n\naws iam create-instance-profile --instance-profile-name SSM\naws iam add-role-to-instance-profile --role-name Role-SSM-instance --instance-profile-name Role-SSM-instance\n"})}),"\n",(0,a.jsx)(n.p,{children:"Mo\u017cesz zobaczy\u0107 wynik:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"aws iam list-instance-profiles\n"})}),"\n",(0,a.jsx)(n.p,{children:"Teraz mo\u017cemy przypisa\u0107 profil instancji IAM do instancji:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"aws ec2 associate-iam-instance-profile --instance-id INSTANCE_ID --iam-instance-profile Name=SSM \n"})}),"\n",(0,a.jsx)(n.p,{children:"Wi\u0119cej informacji:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Role IAM i profil instancji: ",(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html",children:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html"})]}),"\n",(0,a.jsxs)(n.li,{children:["Profil instancji: ",(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/reference/iam/create-instance-profile.html",children:"https://docs.aws.amazon.com/cli/latest/reference/iam/create-instance-profile.html"})]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"zezwolenie-na-ruch-https-w-grupie-zabezpiecze\u0144",children:"Zezwolenie na ruch HTTPS w grupie zabezpiecze\u0144"}),"\n",(0,a.jsx)(n.p,{children:"Grupa zabezpiecze\u0144 dodana do punktu ko\u0144cowego VPC musi zezwala\u0107 na ruch przychodz\u0105cy HTTPS (port 443) z zasob\xf3w w Twoim VPC, kt\xf3re komunikuj\u0105 si\u0119 z us\u0142ug\u0105. W grupie zabezpiecze\u0144 dla EC2 nie musimy zezwala\u0107 na ruch HTTPS tylko po to, aby ustanowi\u0107 po\u0142\u0105czenie z Session Manager."}),"\n",(0,a.jsx)(n.p,{children:"Grupa zabezpiecze\u0144 musi zezwala\u0107 na ruch przychodz\u0105cy HTTPS (port 443) z zasob\xf3w w Twoim VPC, kt\xf3re komunikuj\u0105 si\u0119 z us\u0142ug\u0105."}),"\n",(0,a.jsx)(n.p,{children:"Przyk\u0142ad dla AWS CLI:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"aws ec2 authorize-security-group-ingress \\\n    --group-id sg-ID-Security-Group \\\n    --protocol tcp \\\n    --port 443 \\\n    --source-group sg-1a2b3c4d\n"})}),"\n",(0,a.jsx)(n.p,{children:"Wi\u0119cej informacji:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://aws.amazon.com/premiumsupport/knowledge-center/connect-http-https-ec2/",children:"https://aws.amazon.com/premiumsupport/knowledge-center/connect-http-https-ec2/"})}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u0142\u0105czenie-si\u0119-z-instancj\u0105",children:"\u0141\u0105czenie si\u0119 z instancj\u0105"}),"\n",(0,a.jsx)(n.h3,{id:"konsola-zarz\u0105dzania-aws",children:"Konsola zarz\u0105dzania AWS"}),"\n",(0,a.jsx)(n.p,{children:"Aby rozpocz\u0105\u0107 sesj\u0119 (konsola Amazon EC2)"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Otw\xf3rz konsol\u0119 Amazon EC2 na ",(0,a.jsx)(n.a,{href:"https://console.aws.amazon.com/ec2/",children:"https://console.aws.amazon.com/ec2/"}),"."]}),"\n",(0,a.jsx)(n.li,{children:'W panelu nawigacyjnym wybierz "Instancje".'}),"\n",(0,a.jsx)(n.li,{children:'Wybierz instancj\u0119 i kliknij "Po\u0142\u0105cz".'}),"\n",(0,a.jsx)(n.li,{children:'Wybierz metod\u0119 po\u0142\u0105czenia "Session Manager".'}),"\n",(0,a.jsx)(n.li,{children:'Kliknij "Po\u0142\u0105cz".'}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Wi\u0119cej informacji:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Rozpocz\u0119cie sesji: ",(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-sessions-start.html",children:"https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-sessions-start.html"})]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"interfejs-wiersza-polece\u0144-aws",children:"Interfejs wiersza polece\u0144 AWS"}),"\n",(0,a.jsx)(n.p,{children:"Musisz u\u017cy\u0107 tego polecenia z lokalnej instancji lub CloudShell:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"aws ssm start-session --target instance-id\n"})}),"\n",(0,a.jsx)(n.p,{children:"Wi\u0119cej informacji:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Rozpocz\u0119cie sesji: ",(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-sessions-starthtml#sessions-start-cli",children:"https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-sessions-starthtml#sessions-start-cli"})]}),"\n",(0,a.jsxs)(n.li,{children:["CloudShell: ",(0,a.jsx)(n.a,{href:"https://aws.amazon.com/cloudshell/",children:"https://aws.amazon.com/cloudshell/"})]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"w\u0142\u0105czanie-logowania-sesji-do-s3-i-cloudwatch-z-szyfrowaniem",children:"W\u0142\u0105czanie logowania sesji do S3 i CloudWatch z szyfrowaniem"}),"\n",(0,a.jsx)(n.p,{children:"Mo\u017cesz rejestrowa\u0107 polecenia i szczeg\xf3\u0142y sesji w koszu Amazon S3 lub grupie dziennik\xf3w CloudWatch Logs.\nSkonfiguruj sesje na stronie preferencji Session Manager dla logowania do CloudWatch lub S3."}),"\n",(0,a.jsx)(n.p,{children:"Wa\u017cne:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Ka\u017cde polecenie wraz z wynikiem jest rejestrowane."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Dzienniki s\u0105 zbierane tylko dla po\u0142\u0105cze\u0144 Session Manager."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Strumie\u0144 log\xf3w jest oddzielny dla ka\u017cdej sesji w CloudWatch i zawiera czas wykonania polecenia."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Dzienniki s\u0105 rejestrowane w czasie rzeczywistym w CloudWatch."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"W S3 widzimy osobne pliki dla ka\u017cdej sesji."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Dzienniki s\u0105 rejestrowane po zako\u0144czeniu sesji na S3."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"W S3 nie mamy informacji o czasie wykonania polecenia, tylko czas rozpocz\u0119cia i zako\u0144czenia sesji."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Wi\u0119cej informacji:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Logowanie aktywno\u015bci sesji: ",(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-logging.html",children:"https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-logging.html"})]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"co-musimy-zrobi\u0107",children:"Co musimy zrobi\u0107?"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Og\xf3lne"}),"\n"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Utw\xf3rz klucz KMS do szyfrowania i ustaw polityk\u0119 klucza, aby udzieli\u0107 uprawnie\u0144 roli IAM, kt\xf3ra b\u0119dzie u\u017cywana do logowania sesji."}),"\n",(0,a.jsx)(n.li,{children:"Zaktualizuj polityk\u0119 IAM, kt\xf3ra umo\u017cliwia dost\u0119p do kosza S3 i CloudWatch Logs w celu logowania sesji."}),"\n"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"S3"}),"\n"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Utw\xf3rz kosz S3 do przechowywania dziennik\xf3w sesji z szyfrowaniem."}),"\n",(0,a.jsx)(n.li,{children:'W ustawieniach Session Manager w\u0142\u0105cz "Wy\u015blij dzienniki sesji do S3" i "Wybierz nazw\u0119 kosza z listy". Mo\u017cesz wymusi\u0107 szyfrowanie.'}),"\n"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"CloudWatch"}),"\n"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Utw\xf3rz grup\u0119 dziennik\xf3w CloudWatch do przechowywania dziennik\xf3w sesji z szyfrowaniem."}),"\n",(0,a.jsx)(n.li,{children:"Zaktualizuj polityk\u0119 IAM, kt\xf3ra umo\u017cliwia dost\u0119p do kosza S3 i CloudWatch Logs w celu logowania sesji i u\u017cywania klucza KMS."}),"\n",(0,a.jsx)(n.li,{children:'W ustawieniach Session Manager w\u0142\u0105cz "Logowanie do CloudWatch", wybierz "Stream session logs" i "Wybierz nazw\u0119 grupy dziennik\xf3w z listy". Mo\u017cesz wymusi\u0107 szyfrowanie.'}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Dodatkowe sposoby konfiguracji preferencji Session Manager:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"AWS CLI"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:"SessionManagerRunShell.json",children:'{\n    "schemaVersion": "1.0",\n    "description": "Document to hold regional settings for Session Manager",\n    "sessionType": "Standard_Stream",\n    "inputs": {\n        "s3BucketName": "bucket-s3-logs-sessionmanager",\n        "s3KeyPrefix": "ec2session",\n        "s3EncryptionEnabled": true,\n        "cloudWatchLogGroupName": "EC2Session",\n        "cloudWatchEncryptionEnabled": true,\n        "cloudWatchStreamingEnabled": true,\n        "kmsKeyId": "",\n        "runAsEnabled": false,\n        "runAsDefaultUser": "",\n        "idleSessionTimeout": "",\n        "maxSessionDuration": "",\n        "shellProfile": {\n            "windows": "",\n            "linux": ""\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'aws ssm update-document --name "SSM-SessionManagerRunShell" --content "file://SessionManagerRunShell.json" --document-version "\\$LATEST"\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"CloudFormation z CustomResources. Przygotowanie funkcji Lambda i uruchomienie jej. (w tym konfiguracja w szablonie"}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>r});var a=s(6540);const i={},o=a.createContext(i);function l(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);